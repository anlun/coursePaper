\newpage

\subsection{Библиотека Вадлера}

В \cite{wadler} Филипп Вадлер описал свою комбинаторную бибилиотеку для pretty printing на языке Haskell\footnote{Язык Haskell, http://haskell.org}. Она является модификацией библиотеки Хьюза, описанной в предыдущем разделе. Код библиотеки сократился с \~110 строк до \~80 строк, и, по исследованию Вадлера, на 30\% увеличилась скорость вычисления раскладки документа.

Рассмотрим основые комбинаторы этой библиотеки:
\inputminted{haskell}{codes/wadlerBasicOperations.hs}

Вадлер решил отказаться от двух разных способов соединения документов, оставив лишь горизонтальную склейку. Но для того, чтобы можно было выражать не только однострочные документы, в библиотеке Вадлера появилась функция \textbf{line}. Она создает документ, который может быть переведен в символ новой строки или в пробел.
Функция \textbf{group} имеет то же назначение, что и оператор \textbf{sep} в библиотеке Хьюза, но работает не со списком документов, а с одним документом, и по сути предоставляет альтернативы для алгоритма перевода документа в \textit{String}: в документе, на который подействовал \textbf{group}, либо все вхождения \textbf{line} заменяются на пробел, либо остаются переводами строки (если они не являются частью вложенных \textit{group}-документов).

В таком виде библиотека потеряла в выразительности, что признается в статье Вадлера. Но кроме потери выразительности, есть еще один серьезный недостаток, возникающий из-за оператора \textbf{group}. То, что любой документ им может быть преобразован в однострочный, делает библиотеку неприменимой в некоторых ситуациях. Например, для печати кода на языке Python.

Пусть нам надо написать pretty printer для Python. Для конструкции последовательных операторов pretty printer изображен на рисунке~\ref{fig:pythonPrinter}.
По другому его написать нельзя -- мы хотим, чтобы последовательные операторы печатались на новых строках. Но если такая конструкция попадет внутрь \textit{group}-документа, то последовательные строчки могут склеится пробелом, что сделает код невалидным, так как в Python если на одной строке находятся несколько операторов, то они должны разделяться <<;>>.

\begin{figure}[h!]
	\inputminted{haskell}{codes/pythonPrinter.hs}
	\caption{Принтер для последовательных операторов в Python}
	\label{fig:pythonPrinter}
\end{figure}

Так хороший код (см. рисунок~\ref{fig:pythonCode}) может превратиться в невалидный (см. рисунок~\ref{fig:pythonCodeBad}).
\begin{figure}[h!]
	\begin{minipage}[b]{0.45\linewidth}
		\inputminted{python}{codes/pythonCode.py}
		\caption{}
		\label{fig:pythonCode}
	\end{minipage}
	\hspace{0.5cm}
	\begin{minipage}[b]{0.45\linewidth}
		\inputminted{python}{codes/pythonCodeBad.py}
		\caption{}
		\label{fig:pythonCodeBad}
	\end{minipage}
\end{figure}